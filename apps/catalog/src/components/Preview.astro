---
import Prism from 'prismjs';

let html: string = '';

if (Astro.slots.has('default')) {
    const code = await Astro.slots.render('default')
    html = Prism.highlight(format(code), Prism.languages.html, 'html');
}
function format(html:string) {
    const lines = html.split(/>\s*</);
    let indent = '';
    let result = '';

    for (const [index, line] of lines.entries()) {
        // Decrease indent if line is a closing tag
        if (line.startsWith('/')) {
            indent = indent.substring(1);
        }

        // Only append a > if the current line is not the last line
        if (index < lines.length - 1) {
            result += indent + '<' + line + '>\n';
        } else {
            result += indent + '<' + line + '\n';
        }

        // Increase indent if line is a non-self-closing tag and not an input tag
        if (line.match(/^<?\w[^>]*[^\/]$/) && !line.startsWith("input")) {
            indent += '\t';
        }
    }

    return result.substring(1); // Remove initial indent
}

---
<section class="common-section u-margin-block-start-36" x-data="{ show: 'prev' }">
    <div class="tabs">
        <ul class="tabs-list">
            <li class="tabs-item">
                <button class="tabs-button" x-on:click="show = 'prev'" :class="show === 'prev' ? 'is-selected' : ''">
                    <span class="text">Preview</span>
                </button>
            </li>
            <li class="tabs-item">
                <button class="tabs-button"  x-on:click="show = 'html'" :class="show === 'html' ? 'is-selected' : '' ">
                    <span class="text">HTML</span>
                </button>
            </li>
        </ul>  
    </div>
    <div class="box u-margin-block-start-8" style="padding-top:0; padding-inline: 0; border-radius: 1rem;">
        <template x-if="show === 'prev'">
            <div  class="u-flex u-gap-32 u-flex-wrap common-section u-main-center">
                <slot />
            </div>
        </template>
        <template x-if="show === 'html'">
            <div class="u-padding-32">
                <div class="u-position-absolute u-inset-inline-end-8 u-inset-block-start-8">
                    <button class="button is-small is-text is-only-icon" aria-label="Copy code">
                        <span class="icon-duplicate" aria-hidden="true"></span>
                    </button>
                </div>
                    <pre>
                        <code class="language-html withLineNumbers" set:html={html} />
                    </pre>
            </div>
        </template>
    </div>
</section>
